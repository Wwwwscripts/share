name: Discord Notify

on:
  push:
    branches: ["*"] # všechny branche

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3
        
      - name: Send commit message to Discord (embed)
        env:
          WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          # vezmeme poslední commit message a escapujeme uvozovky a nové řádky
          MESSAGE=$(git log -1 --pretty=%B | tr '\n' ' ' | sed 's/"/\\"/g')
          AUTHOR="${{ github.actor }}"
          REPO="${{ github.repository }}"
          BRANCH="${{ github.ref_name }}"
          COMMIT="${{ github.sha }}"
          
          # vytvoříme JSON embed
          JSON=$(cat <<'EOF'
          {
            "embeds": [
              {
                "title": "New Commit in REPO_PLACEHOLDER",
                "description": "MESSAGE_PLACEHOLDER",
                "color": 5814783,
                "fields": [
                  {"name": "Author", "value": "AUTHOR_PLACEHOLDER", "inline": true},
                  {"name": "Branch", "value": "BRANCH_PLACEHOLDER", "inline": true},
                  {"name": "Commit", "value": "COMMIT_PLACEHOLDER", "inline": false}
                ]
              }
            ]
          }
          EOF
          )
          
          # nahradíme placeholdery skutečnými hodnotami
          JSON="${JSON//REPO_PLACEHOLDER/$REPO}"
          JSON="${JSON//MESSAGE_PLACEHOLDER/$MESSAGE}"
          JSON="${JSON//AUTHOR_PLACEHOLDER/$AUTHOR}"
          JSON="${JSON//BRANCH_PLACEHOLDER/$BRANCH}"
          JSON="${JSON//COMMIT_PLACEHOLDER/$COMMIT}"
          
          # pošleme embed do Discordu
          curl -H "Content-Type: application/json"

name: Discord Notify

on:
  push:
    branches: ["*"]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3
        with:
          fetch-depth: 2
        
      - name: Send commit message to Discord
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          # kontrola, zda m√°me webhook
          if [ -z "$DISCORD_WEBHOOK" ]; then
            echo "Error: DISCORD_WEBHOOK secret is not set!"
            exit 1
          fi
          
          # z√≠sk√°me commit message (prvn√≠ ≈ô√°dek = title, zbytek = description)
          COMMIT_TITLE=$(git log -1 --pretty=%s | sed 's/"/\\"/g' | sed "s/'/\\'/g")
          COMMIT_BODY=$(git log -1 --pretty=%b | sed 's/"/\\"/g' | sed "s/'/\\'/g" | tr '\n' ' ')
          AUTHOR="${{ github.actor }}"
          REPO="${{ github.repository }}"
          COMMIT_SHORT="${{ github.sha }}"
          COMMIT_SHORT="${COMMIT_SHORT:0:7}"
          COMMIT_URL="https://github.com/$REPO/commit/${{ github.sha }}"
          
          # vytvo≈ô√≠me JSON
          cat <<EOF > payload.json
          {
            "embeds": [{
              "title": "$COMMIT_TITLE",
              "description": "$COMMIT_BODY",
              "color": 5814783,
              "fields": [
                {"name": "üë§ Author", "value": "$AUTHOR", "inline": true},
                {"name": "üîó Commit", "value": "[\`$COMMIT_SHORT\`]($COMMIT_URL)", "inline": true}
              ],
              "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%S.000Z)"
            }]
          }
          EOF
          
          # ode≈°leme do Discordu
          curl -H "Content-Type: application/json" \
               -X POST \
               -d @payload.json \
               "$DISCORD_WEBHOOK"
```

**Zmƒõny:**
- ‚úÖ **Title** = Prvn√≠ ≈ô√°dek commit message (`git log --pretty=%s`)
- ‚úÖ **Description** = Zbytek commit message pokud existuje (`git log --pretty=%b`)
- ‚úÖ Pak Author a Commit jako fields

Tak≈æe kdy≈æ udƒõl√°≈° commit:
```
Update kokotina

testuju jestli ta piƒçovina u≈æ funguje jak m√°.
